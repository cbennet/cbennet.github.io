<!DOCTYPE html>
<meta charset="utf-8">
<style> /* set the CSS */
.center {
  margin: auto;
  width: 60%;
  border: 3px solid #73AD21;
  padding: 10px;
}
</style>
<head>     
    <title>This is the title of the webpage!</title>
</head>
<body>
<div class="center">
    <select id="stateSelectButton"></select>
    <select id="crimeSelectButton"></select>
    <select id="typeSelectButton"></select>
    <button onclick="makePlot()"> Show Plot </button>
</div>

    <svg width="900" height="1200"></svg>

<!-- load the d3.js library -->    
<script src="https://d3js.org/d3.v6.min.js"></script>

<script>
    var allStates = ['National_Total', 'AK', 'AL', 'AR', 'AZ', 'CA', 'CO', 'CT', 'DC', 'DE',
                    'FL', 'GA', 'HI', 'IA', 'ID', 'IL', 'IN', 'KS', 'KY', 'LA', 'MA', 'MD', 'ME', 'MI', 'MN', 'MO',
                    'MS', 'MT', 'NC', 'ND', 'NE', 'NH', 'NJ', 'NM', 'NV', 'NY' ,'OH', 'OK', 'OR', 'PA',
                    'RI', 'SC', 'SD', 'TN', 'TX', 'UT', 'VA', 'VT', 'WA', 'WI', 'WV', 'WY']
    
    var allCrimes = ["violent_crime",	"homicide",	"rape_legacy",	"rape_revised",	"robbery",	"aggravated_assault",	"property_crime",	"burglary",	"larceny",	"motor_vehicle_theft"]

    var allTypes = ["Overall", "vs Population", "vs Total Crimes"]

    d3.select("#stateSelectButton")
      .selectAll('myOptions')
     	.data(allStates)
      .enter()
    	.append('option')
      .text(function (d) { return d; })
      .attr("value", function (d) { return d; })
      
      d3.select("#crimeSelectButton")
      .selectAll('myOptions')
     	.data(allCrimes)
      .enter()
    	.append('option')
      .text(function (d) { return d; })
      .attr("value", function (d) { return d; })

      d3.select("#typeSelectButton")
      .selectAll('myOptions')
     	.data(allTypes)
      .enter()
    	.append('option')
      .text(function (d) { return d; })
      .attr("value", function (d) { return d; })
      

function makePlot(){
    d3.selectAll("g > *").remove()
    var curState = document.getElementById("stateSelectButton").value
    var curCrime = document.getElementById("crimeSelectButton").value
    var curType = document.getElementById("typeSelectButton").value

    console.log(curState)
    console.log(curCrime)
    console.log(curType)

    var plotType
    
    if(curType == allTypes[0])
    {
        plotType = ""
    }
    else if(curType == allTypes[1])
    {
        plotType = "_popPercent"
    }
    else if(curType == allTypes[2])
    {
        plotType = "_crimePercent"
    }

    var svg = d3.select("svg"),
        margin = 200,
        width = svg.attr("width") - margin,
        height = svg.attr("height") - 500;


    var xScale = d3.scaleBand().range ([0, width]).padding(0.4),
        yScale = d3.scaleLinear().range ([height, 0]);

    var g = svg.append("g")
            .attr("transform", "translate(" + 100 + "," + 100 + ")");

    d3.csv("crimes_updated.csv").then(function (csvData){
        data = csvData.filter(function(row){
            return row.state_abbr === curState
        });
        xScale.domain(data.map(function(d) { return d.year; }));
        yScale.domain([0, 1.2*d3.max(data, function(d) { return d[curCrime + plotType]; })]);
        

    g.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(xScale)
            )
            .selectAll("text")
            .attr("text-anchor", "end")
            .attr("dy", "0.1em")
            .attr("dx", "-0.3em")
            .attr("transform", "rotate(-65)")


        g.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(xScale).tickValues([])
            )
            .append("text")
            .attr("y", height - 650)
            .attr("x", width - 100)
            .attr("text-anchor", "end")
            .attr("stroke", "black")
            .text("Year");

        g.append("g")
            .call(d3.axisLeft(yScale)
            .ticks(10))
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", "-5.1em")
            .attr("text-anchor", "end")
            .attr("stroke", "black")
            .text("Crimes "+ plotType);

        g.append("text")
            .attr("x", (width / 2))             
            .attr("y", 0 - (margin.top / 2))
            .attr("text-anchor", "middle")  
            .style("font-size", "16px") 
            .style("text-decoration", "underline")  
            .text(curCrime +" "+ curType+ " commited in " + curState);

        g.selectAll(".bar")
            .data(data)
            .enter().append("rect")
            .attr("class", "bar")
            .attr("x", function(d) { return xScale(d.year); })
            .attr("y", function(d) { return yScale(d[curCrime + plotType]); })
            .attr("width", xScale.bandwidth())
            .attr("height", function(d) { return height - yScale(d[curCrime + plotType]); });
        }
    )
}

</script>

</body>